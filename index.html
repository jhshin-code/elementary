<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #4a90e2; --highlight-bg: #fffdf5; --highlight-border: #ffc107; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        #table-container { max-width: 1000px; margin: 90px auto 40px; }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .controls { position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 12px 20px; box-shadow: 0 2px 10px rgba(0,0,0,.1); z-index: 1000; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        button { padding: 8px 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-green { background: #28a745; color: #fff; }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-yellow { background: #ffc107; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 6px; width: 110px; }

        /* ì›”ë³„ ì„¹ì…˜ */
        .month-section { background: #fff; margin-bottom: 25px; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
        .month-label { background: var(--primary); color: #fff; padding: 15px 25px; font-size: 1.15rem; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .month-label::after { content: 'â–¼'; transition: .3s; }
        .month-section.collapsed .month-label::after { transform: rotate(-90deg); }
        .month-section.collapsed .month-content { display: none; }

        /* ì£¼ì°¨ë³„ ì¹´ë“œ */
        .week-card { border: 1px solid #e1e4e8; border-radius: 10px; margin: 15px; background: #fff; }
        .week-card.highlight { border: 2px solid var(--highlight-border) !important; background: var(--highlight-bg) !important; }
        .week-header { padding: 18px 20px; cursor: pointer; }
        
        /* ì•”ì†¡ ì •ë ¬ ê´€ë ¨ ìˆ˜ì • */
        .info-row { display: flex; gap: 10px; margin-top: 8px; font-size: .95rem; line-height: 1.5; align-items: flex-start; }
        .info-label { width: 68px; color: #888; font-weight: bold; flex-shrink: 0; white-space: nowrap; }
        .info-content { flex-grow: 1; word-break: keep-all; }
        .link-icon { text-decoration: none; margin-left: 5px; }

        /* ìƒì„¸ í…Œì´ë¸” */
        .detail-table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        .detail-table td { border: 1px solid #f0f0f0; padding: 12px 2px; text-align: center; font-size: 0.85rem; }
        .role-header { background: #f8f9fa; font-weight: bold; font-size: .8rem; color: #666; }
        .ban-1 { color: #28a745; font-weight: bold; }
        .ban-2 { color: #007bff; font-weight: bold; }

        mark { background: #fffd54; font-weight: bold; padding: 0 2px; }
        #error-msg { color: red; text-align: center; padding: 20px; display: none; }
    </style>
</head>
<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">ëª¨ë“  ë‹¬ í¼ì¹˜ê¸°/ì ‘ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-blue" onclick="searchName()">ê²€ìƒ‰</button>
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥ ë³´ê¸°</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center;">2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</h1>
    <p style="text-align:center;color:#6c757d;">â€» ë‹¤ìŒ ì£¼ ì¼ìš”ì¼ì´ ìë™ìœ¼ë¡œ ê°•ì¡°ë©ë‹ˆë‹¤.</p>
    <div id="error-msg">ë°ì´í„°(data.csv)ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ëª…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
    <div id="render-area"></div>
</div>

<script>
let csvData = [];
let isAllExpanded = false;
const CURRENT_YEAR = 2026;

// ë‚ ì§œ íŒŒì‹± (1/4 ë˜ëŠ” 2026-01-04 ëŒ€ì‘)
function parseDate(str) {
    if (!str) return null;
    let y = CURRENT_YEAR, m, d;
    const p = str.includes('/') ? str.split('/') : str.split('-');
    if (p.length === 3) { y = parseInt(p[0]); m = parseInt(p[1]); d = parseInt(p[2]); }
    else { m = parseInt(p[0]); d = parseInt(p[1]); }
    return new Date(y, m - 1, d);
}

window.onload = () => {
    // data.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ì¶”ê°€)
    Papa.parse("data.csv?v=" + new Date().getTime(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            if (csvData.length === 0) {
                document.getElementById('error-msg').style.display = 'block';
                return;
            }
            csvData.sort((a, b) => parseDate(a.ë‚ ì§œ) - parseDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrent();
        },
        error: err => {
            console.error(err);
            document.getElementById('error-msg').style.display = 'block';
        }
    });
};

function renderByMonth(data) {
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseDate(r.ë‚ ì§œ);
        if(!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeksHtml = "";
        groups[key].forEach(r => {
            const linkTag = r.ì°¬ì–‘ë§í¬ ? `<a href="${r.ì°¬ì–‘ë§í¬}" target="_blank" class="link-icon">ğŸ”—</a>` : "";
            weeksHtml += `
            <div class="week-card" id="card-${r.ë‚ ì§œ.replace(/\//g, '-')}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary)">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b style="font-size:1.1rem;">${r.ê³¼}ê³¼: ${r.ì œëª©}</b>
                    <div class="info-row">
                        <span class="info-label">ğŸµ ì°¬ì–‘</span>
                        <span class="info-content">${r.ì°¬ì–‘ê³¡ëª… || '-'}${linkTag}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ“– ì•”ì†¡</span>
                        <span class="info-content">${r.ì•”ì†¡ë§ì”€ || '-'}</span>
                    </div>
                </div>
                <div class="week-detail" id="det-${r.ë‚ ì§œ.replace(/\//g, '-')}" style="display:none;padding:0 20px 20px;">
                    <table class="detail-table">
                        <tr class="role-header">
                            <td style="width:12%">êµ¬ë¶„</td>
                            <td>ğŸ¹ë°˜ì£¼</td>
                            <td>ğŸ¤ì°¬ì–‘</td>
                            <td>ğŸ’ƒì°¬ìœ¨</td>
                            <td>ğŸ“œì•”ì†¡</td>
                            <td>ğŸ™Œì†ìœ í¬</td>
                        </tr>
                        <tr>
                            <td class="ban-1">1ë°˜</td>
                            <td class="role-cell">${r.ë°˜ì£¼1 || ''}</td><td class="role-cell">${r.ì°¬ì–‘1 || ''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨1 || ''}</td><td class="role-cell">${r.ì•”ì†¡1 || ''}</td><td class="role-cell">${r.ì†ìœ í¬1 || ''}</td>
                        </tr>
                        <tr>
                            <td class="ban-2">2ë°˜</td>
                            <td class="role-cell">${r.ë°˜ì£¼2 || ''}</td><td class="role-cell">${r.ì°¬ì–‘2 || ''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨2 || ''}</td><td class="role-cell">${r.ì•”ì†¡2 || ''}</td><td class="role-cell">${r.ì†ìœ í¬2 || ''}</td>
                        </tr>
                    </table>
                </div>
            </div>`;
        });

        sec.innerHTML = `<div class="month-label" onclick="toggleMonth('${key}')">${y}ë…„ ${parseInt(m)}ì›”</div>
                         <div class="month-content">${weeksHtml}</div>`;
        area.appendChild(sec);
    });
}

function autoExpandCurrent() {
    const now = new Date();
    const nextSunday = new Date(now);
    // ë‹¤ìŒ ì£¼ ì¼ìš”ì¼ ê³„ì‚°
    nextSunday.setDate(now.getDate() + (7 - now.getDay()) % 7);
    
    const y = nextSunday.getFullYear();
    const m = String(nextSunday.getMonth() + 1).padStart(2, '0');
    const curMonthKey = `${y}-${m}`;
    
    const sec = document.getElementById(`sec-${curMonthKey}`);
    if (sec) sec.classList.remove('collapsed');

    const targetDateStr = `${nextSunday.getMonth() + 1}-${nextSunday.getDate()}`;
    const targetDateStrAlt = `${nextSunday.getMonth() + 1}/${nextSunday.getDate()}`;
    const card = document.getElementById(`card-${targetDateStr}`) || document.getElementById(`card-${targetDateStrAlt.replace(/\//g, '-')}`);
    
    if (card) {
        card.classList.add('highlight');
        const detId = card.id.replace('card-', 'det-');
        const det = document.getElementById(detId);
        if (det) det.style.display = 'block';
        setTimeout(() => { card.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 500);
    }
}

function toggleMonth(m) { document.getElementById(`sec-${m}`).classList.toggle('collapsed'); }
function toggleWeek(d) {
    const id = d.replace(/\//g, '-');
    const el = document.getElementById(`det-${id}`);
    if (el) el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
}
function toggleAllMonths() {
    isAllExpanded = !isAllExpanded;
    document.querySelectorAll('.month-section').forEach(s => s.classList.toggle('collapsed', !isAllExpanded));
}
function searchName() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return;
    document.querySelectorAll('.role-cell').forEach(td => {
        td.innerHTML = td.innerText;
        if (td.innerText.includes(name)) {
            td.innerHTML = `<mark>${name}</mark>`;
            const card = td.closest('.week-card');
            const sec = td.closest('.month-section');
            if (card) { 
                const det = card.querySelector('.week-detail');
                if (det) det.style.display = 'block';
            }
            if (sec) sec.classList.remove('collapsed');
        }
    });
}
function showMyList() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) { alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"); return; }
    let list = csvData.filter(r => Object.values(r).some(v => v.toString().includes(name)))
                      .map(r => `${r.ë‚ ì§œ} (${r.ì œëª©})`);
    alert(list.length > 0 ? `[${name}] ë‹˜ ë‹´ë‹¹:\n` + list.join('\n') : "ë‹´ë‹¹ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
}
function exportImage() {
    html2canvas(document.getElementById('table-container'), { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL();
        link.download = '2026_ê¸°ëŠ¥ì¼ì •.png';
        link.click();
    });
}
</script>
</body>
</html>

