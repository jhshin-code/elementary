<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #4a90e2; --highlight-bg: #fffdf5; --highlight-border: #ffc107; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        #table-container { max-width: 1000px; margin: 90px auto 40px; background: #f0f2f5; }

        /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ëŸ¬ */
        .controls { position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 12px 20px; box-shadow: 0 2px 10px rgba(0,0,0,.1); z-index: 1000; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        button { padding: 8px 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-green { background: #28a745; color: #fff; }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-yellow { background: #ffc107; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 6px; width: 110px; }

        /* ì„¹ì…˜ ë””ìì¸ */
        .month-section { background: #fff; margin-bottom: 25px; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
        .month-label { background: var(--primary); color: #fff; padding: 15px 25px; font-size: 1.15rem; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .month-label::after { content: 'â–¼'; transition: .3s; }
        .month-section.collapsed .month-label::after { transform: rotate(-90deg); }
        .month-section.collapsed .month-content { display: none; }

        /* ì¹´ë“œ ë””ìì¸ */
        .week-card { border: 1px solid #e1e4e8; border-radius: 10px; margin: 15px; background: #fff; }
        .week-card.highlight { border: 2px solid var(--highlight-border) !important; background: var(--highlight-bg) !important; }
        .week-header { padding: 18px 20px; cursor: pointer; }
        
        .info-row { display: flex; gap: 10px; margin-top: 8px; font-size: .95rem; line-height: 1.5; align-items: flex-start; }
        .info-label { width: 68px; color: #888; font-weight: bold; flex-shrink: 0; white-space: nowrap; }
        .info-content { flex-grow: 1; word-break: keep-all; }
        .link-icon { text-decoration: none; margin-left: 5px; font-size: 1.1rem; }

        /* ìƒì„¸ í‘œ */
        .detail-table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        .detail-table td { border: 1px solid #f0f0f0; padding: 12px 2px; text-align: center; font-size: 0.82rem; word-break: keep-all; }
        .role-header { background: #f8f9fa; font-weight: bold; font-size: .78rem; color: #666; }
        .ban-1 { color: #28a745; font-weight: bold; }
        .ban-2 { color: #007bff; font-weight: bold; }

        mark { background: #fffd54; font-weight: bold; padding: 0 2px; }
        #error-msg { color: red; text-align: center; padding: 20px; display: none; background: #fff; margin: 20px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">ëª¨ë“  ë‹¬ í¼ì¹˜ê¸°/ì ‘ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-blue" onclick="searchName()">ê²€ìƒ‰</button>
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥ ë³´ê¸°</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center; padding-top: 20px;">2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</h1>
    <p style="text-align:center;color:#6c757d;">â€» ë‹¤ìŒ ì£¼ ì¼ìš”ì¼ ì¼ì •ì´ ìë™ìœ¼ë¡œ ê°•ì¡°ë©ë‹ˆë‹¤.</p>
    <div id="error-msg">data.csv íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ëª…ê³¼ ëŒ€ì†Œë¬¸ìë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
    <div id="render-area"></div>
</div>

<script>
let csvData = [];
const CURRENT_YEAR = 2026;

function parseDate(str) {
    if (!str) return null;
    let y = CURRENT_YEAR, m, d;
    const p = str.includes('/') ? str.split('/') : str.split('-');
    if (p.length === 3) { y = parseInt(p[0]); m = parseInt(p[1]); d = parseInt(p[2]); }
    else { m = parseInt(p[0]); d = parseInt(p[1]); }
    return new Date(y, m - 1, d);
}

window.onload = () => {
    Papa.parse("data.csv?v=" + new Date().getTime(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            if (csvData.length === 0) {
                document.getElementById('error-msg').innerText = "CSV ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.";
                document.getElementById('error-msg').style.display = 'block';
                return;
            }
            csvData.sort((a, b) => parseDate(a.ë‚ ì§œ) - parseDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrent();
        },
        error: err => {
            document.getElementById('error-msg').style.display = 'block';
        }
    });
};

function renderByMonth(data) {
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseDate(r.ë‚ ì§œ);
        if(!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeksHtml = "";
        groups[key].forEach(r => {
            // CSV í—¤ë” ì´ë¦„ì— ë§ê²Œ ìˆ˜ì • (ê³µë°± ì£¼ì˜)
            const songName = r['ì°¬ì–‘ ê³¡ëª…'] || '-';
            const songLink = r['ì°¬ì–‘ LINK'] || '';
            const linkTag = songLink ? `<a href="${songLink}" target="_blank" class="link-icon">ğŸ”—</a>` : "";
            
            weeksHtml += `
            <div class="week-card" id="card-${r.ë‚ ì§œ.replace(/\//g, '-')}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary)">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b style="font-
