<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #4a90e2; --highlight-bg: #fffdf5; --highlight-border: #ffc107; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        #table-container { max-width: 1000px; margin: 90px auto 40px; background: #f0f2f5; }

        /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ëŸ¬ */
        .controls { position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 12px 20px; box-shadow: 0 2px 10px rgba(0,0,0,.1); z-index: 1000; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        button { padding: 8px 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-green { background: #28a745; color: #fff; }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-yellow { background: #ffc107; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 6px; width: 110px; }

        /* ì„¹ì…˜ ë° ì¹´ë“œ */
        .month-section { background: #fff; margin-bottom: 25px; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
        .month-label { background: var(--primary); color: #fff; padding: 15px 25px; font-size: 1.15rem; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .month-label::after { content: 'â–¼'; transition: .3s; }
        .month-section.collapsed .month-label::after { transform: rotate(-90deg); }
        .month-section.collapsed .month-content { display: none; }

        .week-card { border: 1px solid #e1e4e8; border-radius: 10px; margin: 15px; background: #fff; }
        .week-card.highlight { border: 3px solid var(--highlight-border) !important; background: var(--highlight-bg) !important; }
        .week-header { padding: 18px 20px; cursor: pointer; }
        
        .info-row { display: flex; gap: 10px; margin-top: 8px; font-size: 1rem; line-height: 1.5; align-items: flex-start; }
        .info-label { width: 75px; color: #888; font-weight: bold; flex-shrink: 0; }
        .info-content { flex-grow: 1; word-break: keep-all; font-weight: 500; }

        /* [ìˆ˜ì •] ìƒì„¸ í‘œ ë° ë‹´ë‹¹ì í°íŠ¸ ì„¤ì • */
        .detail-table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; border: 1px solid #eee; }
        .detail-table td { border: 1px solid #f0f0f0; padding: 14px 2px; text-align: center; word-break: keep-all; }
        
        .role-header { background: #f8f9fa; font-weight: bold; font-size: 0.85rem; color: #555; height: 40px; }
        
        /* ë‹´ë‹¹ì ì´ë¦„ ì„¸í¬(Cell) ìŠ¤íƒ€ì¼ ê°•í™” */
        .role-cell { 
            font-size: 1rem;      /* í°íŠ¸ í¬ê¸° í‚¤ì›€ */
            font-weight: 700;    /* ë” ì§„í•˜ê²Œ */
            color: #222;         /* ì„ ëª…í•œ ê²€ì •ìƒ‰ */
            background: #fafafa; /* ë°°ê²½ìƒ‰ì„ ì‚´ì§ ë„£ì–´ ê°•ì¡° */
        }

        .ban-1 { background: #e9f7ef; color: #28a745; font-weight: 800; font-size: 0.9rem; }
        .ban-2 { background: #ebf5ff; color: #007bff; font-weight: 800; font-size: 0.9rem; }

        /* ê²€ìƒ‰ ê°•ì¡° íš¨ê³¼ */
        mark { 
            background: #ff5722; 
            color: white; 
            font-weight: bold; 
            padding: 2px 4px; 
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        #error-msg { color: red; text-align: center; padding: 20px; display: none; background: #fff; margin: 20px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">ëª¨ë“  ë‹¬ í¼ì¹˜ê¸°/ì ‘ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥ ë³´ê¸°</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center; padding-top: 20px;">2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</h1>
    <p style="text-align:center;color:#6c757d;">â€» ë‹´ë‹¹ ê¸°ëŠ¥ ë¶ˆê°€ ì‹œ ë¯¸ë¦¬ ë§ì”€ í•´ì£¼ì„¸ìš”</p>
    <div id="render-area"></div>
</div>

<script>
let csvData = [];
const CURRENT_YEAR = 2026;

function parseDate(str) {
    if (!str) return null;
    let y = CURRENT_YEAR, m, d;
    const p = str.includes('/') ? str.split('/') : str.split('-');
    if (p.length === 3) { y = parseInt(p[0]); m = parseInt(p[1]); d = parseInt(p[2]); }
    else { m = parseInt(p[0]); d = parseInt(p[1]); }
    return new Date(y, m - 1, d);
}

window.onload = () => {
    Papa.parse("data.csv?v=" + new Date().getTime(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            csvData.sort((a, b) => parseDate(a.ë‚ ì§œ) - parseDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrent();
        },
        error: err => { document.getElementById('error-msg').style.display = 'block'; }
    });
};

function renderByMonth(data) {
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseDate(r.ë‚ ì§œ);
        if(!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeksHtml = "";
        groups[key].forEach(r => {
            const songName = r['ì°¬ì–‘ ê³¡ëª…'] || '-';
            const songLink = r['ì°¬ì–‘ LINK'] || '';
            const linkTag = songLink ? `<a href="${songLink}" target="_blank" class="link-icon">ğŸ”—</a>` : "";
            
            weeksHtml += `
            <div class="week-card" id="card-${r.ë‚ ì§œ.replace(/\//g, '-')}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary)">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b style="font-size:1.15rem;">${r.ê³¼}ê³¼: ${r.ì œëª©} (${r.ë§ì”€ || ''})</b>
                    <div class="info-row"><span class="info-label">ğŸµ ì°¬ì–‘</span><span class="info-content">${songName}${linkTag}</span></div>
                    <div class="info-row"><span class="info-label">ğŸ“– ì•”ì†¡</span><span class="info-content">${r.ì•”ì†¡ë§ì”€ || '-'}</span></div>
                </div>
                <div class="week-detail" id="det-${r.ë‚ ì§œ.replace(/\//g, '-')}" style="display:none;padding:0 20px 20px;">
                    <table class="detail-table">
                        <tr class="role-header">
                            <td style="width:12%">êµ¬ë¶„</td><td>ğŸ“šê³µê³¼</td><td>ğŸ¹ë°˜ì£¼</td><td>ğŸ¤ì°¬ì–‘</td><td>ğŸ’ƒì°¬ìœ¨</td><td>ğŸ“œì•”ì†¡</td><td>ğŸ™Œì†ìœ í¬</td>
                        </tr>
                        <tr>
                            <td class="ban-1">1ë°˜</td>
                            <td class="role-cell">${r.ê³µê³¼1 || ''}</td><td class="role-cell">${r.ë°˜ì£¼1 || ''}</td>
                            <td class="role-cell">${r.ì°¬ì–‘1 || ''}</td><td class="role-cell">${r.ì°¬ìœ¨1 || ''}</td>
                            <td class="role-cell">${r.ì•”ì†¡1 || ''}</td><td class="role-cell">${r.ì†ìœ í¬1 || ''}</td>
                        </tr>
                        <tr>
                            <td class="ban-2">2ë°˜</td>
                            <td class="role-cell">${r.ê³µê³¼2 || ''}</td><td class="role-cell">${r.ë°˜ì£¼2 || ''}</td>
                            <td class="role-cell">${r.ì°¬ì–‘2 || ''}</td><td class="role-cell">${r.ì°¬ìœ¨2 || ''}</td>
                            <td class="role-cell">${r.ì•”ì†¡2 || ''}</td><td class="role-cell">${r.ì†ìœ í¬2 || ''}</td>
                        </tr>
                    </table>
                </div>
            </div>`;
        });
        sec.innerHTML = `<div class="month-label" onclick="toggleMonth('${key}')">${y}ë…„ ${parseInt(m)}ì›”</div><div class="month-content">${weeksHtml}</div>`;
        area.appendChild(sec);
    });
}

function autoExpandCurrent() {
    const now = new Date();
    const nextSunday = new Date(now);
    nextSunday.setDate(now.getDate() + (7 - now.getDay()) % 7 );
    const y = nextSunday.getFullYear();
    const m = String(nextSunday.getMonth() + 1).padStart(2, '0');
    const sec = document.getElementById(`sec-${y}-${m}`);
    if (sec) sec.classList.remove('collapsed');
    const target = `card-${nextSunday.getMonth() + 1}-${nextSunday.getDate()}`;
    const card = document.getElementById(target) || document.getElementById(target.replace('-', '/'));
    if (card) {
        card.classList.add('highlight');
        document.getElementById(card.id.replace('card-', 'det-')).style.display = 'block';
        setTimeout(() => { card.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 500);
    }
}

function toggleMonth(m) { document.getElementById(`sec-${m}`).classList.toggle('collapsed'); }
function toggleWeek(d) {
    const id = d.replace(/\//g, '-');
    const el = document.getElementById(`det-${id}`);
    if (el) el.style.display = (el.style.display === 'none') ? 'block' : 'none';
}
function toggleAllMonths() {
    const sections = document.querySelectorAll('.month-section');
    const anyExpanded = Array.from(sections).some(s => !s.classList.contains('collapsed'));
    sections.forEach(s => s.classList.toggle('collapsed', anyExpanded));
}
function searchName() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return;
    document.querySelectorAll('.role-cell').forEach(td => {
        td.innerHTML = td.innerText;
        if (td.innerText.includes(name)) {
            td.innerHTML = `<mark>${name}</mark>`;
            const card = td.closest('.week-card');
            const sec = td.closest('.month-section');
            if (card) card.querySelector('.week-detail').style.display = 'block';
            if (sec) sec.classList.remove('collapsed');
        }
    });
}
function showMyList() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) { alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"); return; }
    let list = csvData.filter(r => Object.values(r).some(v => v.toString().includes(name))).map(r => `${r.ë‚ ì§œ} (${r.ì œëª©})`);
    alert(list.length > 0 ? `[${name}] ë‹˜ ë‹´ë‹¹:\n` + list.join('\n') : "ë‹´ë‹¹ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
}
function exportImage() {
    html2canvas(document.getElementById('table-container'), { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL();
        link.download = '2026_ê¸°ëŠ¥ì¼ì •.png';
        link.click();
    });
}
</script>
</body>
</html>



