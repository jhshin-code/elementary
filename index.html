<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
    :root{ --primary:#4a90e2; --highlight-bg:#fffdf5; --highlight-border:#ffc107; }
    body{ font-family:'Malgun Gothic',sans-serif; background:#f0f2f5; padding:20px; margin:0; }
    #table-container{max-width:1000px;margin:90px auto 40px;}
    .controls{ position:fixed;top:0;left:0;right:0; background:#fff;padding:12px 20px; box-shadow:0 2px 10px rgba(0,0,0,.1); z-index:1000; display:flex;gap:8px;justify-content:center;flex-wrap:wrap; }
    .month-section{ background:#fff; margin-bottom:25px; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,.05); }
    .month-label{ background:var(--primary); color:#fff; padding:15px 25px; font-size:1.15rem; font-weight:bold; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
    .month-label::after{content:'â–¼';transition:.3s;}
    .month-section.collapsed .month-label::after{transform:rotate(-90deg);}
    .month-section.collapsed .month-content{display:none;}
    .week-card{ border:1px solid #e1e4e8; border-radius:10px; margin:15px; background:#fff; }
    .week-card.highlight{ border:2px solid var(--highlight-border) !important; background:var(--highlight-bg) !important; box-shadow: 0 0 10px rgba(255,193,7,0.3); }
    .week-header{padding:18px 20px;cursor:pointer;}
    .info-row{display:flex;gap:8px;margin-top:8px;font-size:.95rem;}
    .info-label{width:45px;color:#999;font-weight:bold;}
    .detail-table{ width:100%; border-collapse:collapse; margin-top:10px; table-layout: fixed; }
    .detail-table td{ border:1px solid #f0f0f0; padding:10px 5px; text-align:center; word-break: break-all; }
    .role-header{background:#f8f9fa;font-weight:bold;font-size:.85rem;}
    button{ padding:8px 15px;border:none;border-radius:6px; font-weight:bold;cursor:pointer; }
    .btn-green{background:#28a745;color:#fff;}
    .btn-blue{background:#007bff;color:#fff;}
    .btn-yellow{background:#ffc107;}
    input{ padding:8px;border:1px solid #ccc; border-radius:6px;width:110px; }
    mark{background:#fffd54;font-weight:bold;}
</style>
</head>
<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">ëª¨ë“  ë‹¬ í¼ì¹˜ê¸°/ì ‘ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-blue" onclick="searchName()">ê²€ìƒ‰</button>
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥ ë³´ê¸°</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center;">2025 ê¸°ëŠ¥ ìš”ì•½í‘œ</h1>
    <p style="text-align:center;color:#6c757d;">â€» ì´ë²ˆ ë‹¬ë§Œ í¼ì³ì§€ê³ , ì´ë²ˆ ì£¼ ì¼ìš”ì¼ì´ ìë™ ê°•ì¡°ë©ë‹ˆë‹¤.</p>
    <div id="render-area"></div>
</div>

<script>
let csvData=[];
let isAllExpanded=false;

// ë‚ ì§œ ë¬¸ìì—´(YYYY-MM-DD)ì„ Date ê°ì²´ë¡œ ë³€í™˜
function parseLocalDate(str){
    if(!str) return null;
    const parts = str.split('-');
    return new Date(parts[0], parts[1]-1, parts[2]);
}

window.onload=()=>{
    Papa.parse("data.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            // ë‚ ì§œìˆœ ì •ë ¬
            csvData.sort((a,b) => parseLocalDate(a.ë‚ ì§œ) - parseLocalDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrentWeek();
        }
    });
};

function renderByMonth(data){
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseLocalDate(r.ë‚ ì§œ);
        if(!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        if(!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeks = "";
        groups[key].forEach(r => {
            weeks += `
            <div class="week-card" id="card-${r.ë‚ ì§œ}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary)">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b>${r.ê³¼}ê³¼: ${r.ì œëª©}</b>
                    <div class="info-row"><span class="info-label">ğŸµ</span><span>${r.ì°¬ì–‘ê³¡ëª…||'-'}</span></div>
                    <div class="info-row"><span class="info-label">ğŸ“–</span><span>${r.ì•”ì†¡ë§ì”€||'-'}</span></div>
                </div>
                <div class="week-detail" id="det-${r.ë‚ ì§œ}" style="display:none;padding:0 20px 20px;">
                    <table class="detail-table">
                        <tr class="role-header"><td>êµ¬ë¶„</td><td>ë°˜ì£¼</td><td>ì°¬ì–‘</td><td>ì°¬ìœ¨</td><td>ì•”ì†¡</td><td>ì†ìœ í¬</td></tr>
                        <tr>
                            <td>1ë°˜</td>
                            <td class="role-cell">${r.ë°˜ì£¼1||''}</td><td class="role-cell">${r.ì°¬ì–‘1||''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨1||''}</td><td class="role-cell">${r.ì•”ì†¡1||''}</td><td class="role-cell">${r.ì†ìœ í¬1||''}</td>
                        </tr>
                        <tr>
                            <td>2ë°˜</td>
                            <td class="role-cell">${r.ë°˜ì£¼2||''}</td><td class="role-cell">${r.ì°¬ì–‘2||''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨2||''}</td><td class="role-cell">${r.ì•”ì†¡2||''}</td><td class="role-cell">${r.ì†ìœ í¬2||''}</td>
                        </tr>
                    </table>
                </div>
            </div>`;
        });

        sec.innerHTML = `
            <div class="month-label" onclick="toggleMonth('${key}')">${y}ë…„ ${parseInt(m)}ì›”</div>
            <div class="month-content">${weeks}</div>`;
        area.appendChild(sec);
    });
}

function autoExpandCurrentWeek(){
    const now = new Date();
    const day = now.getDay(); // 0(ì¼) ~ 6(í† )
    const sunday = new Date(now);
    
    // ë‹¤ê°€ì˜¬ ì¼ìš”ì¼ ê³„ì‚° (ì˜¤ëŠ˜ì´ ì¼ìš”ì¼ì´ë©´ ì˜¤ëŠ˜, ì•„ë‹ˆë©´ ì´ë²ˆì£¼ ì¼ìš”ì¼)
    const diff = (day === 0) ? 0 : (7 - day);
    sunday.setDate(now.getDate() + (day === 0 ? 0 : (7 - day - 7))); // ì´ë²ˆ ì£¼ ì¼ìš”ì¼ë¡œ ê³ ì • (ì§€ë‚œ ì¼ìš”ì¼ ë³´ë ¤ë©´ diff ìˆ˜ì •)
    
    // í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ ê°€ì¥ ê°€ê¹Œìš´ ì¼ìš”ì¼ ì°¾ê¸° ë¡œì§ (ìˆ˜ì •ë¨)
    const targetSun = new Date(now);
    targetSun.setDate(now.getDate() + ((0 - now.getDay() + 7) % 7));
    if(now.getDay() === 0) targetSun.setDate(now.getDate()); // ì˜¤ëŠ˜ì´ ì¼ìš”ì¼ì´ë©´ ì˜¤ëŠ˜

    const y = targetSun.getFullYear();
    const m = String(targetSun.getMonth()+1).padStart(2,'0');
    const d = String(targetSun.getDate()).padStart(2,'0');
    const dateStr = `${y}-${m}-${d}`;

    // 1. ëª¨ë“  ë‹¬ ë‹«ê¸° í›„ ì´ë²ˆ ë‹¬ë§Œ ì—´ê¸°
    document.querySelectorAll('.month-section').forEach(s => s.classList.add('collapsed'));
    const curMonthSec = document.getElementById(`sec-${y}-${m}`);
    if(curMonthSec) curMonthSec.classList.remove('collapsed');

    // 2. ì´ë²ˆ ì£¼ ì¹´ë“œ ê°•ì¡° ë° í¼ì¹˜ê¸°
    const card = document.getElementById(`card-${dateStr}`);
    if(card){
        card.classList.add('highlight');
        const detail = document.getElementById(`det-${dateStr}`);
        if(detail) detail.style.display = 'block';
        setTimeout(() => card.scrollIntoView({behavior:'smooth', block:'center'}), 500);
    }
}

function toggleMonth(m){ document.getElementById(`sec-${m}`).classList.toggle('collapsed'); }
function toggleWeek(d){
    const el = document.getElementById(`det-${d}`);
    if(el) el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
}
function toggleAllMonths(){
    isAllExpanded = !isAllExpanded;
    document.querySelectorAll('.month-section').forEach(s => s.classList.toggle('collapsed', !isAllExpanded));
}

function searchName(){
    const name = document.getElementById('search-name').value.trim();
    if(!name) return;
    document.querySelectorAll('.role-cell').forEach(td => {
        td.innerHTML = td.innerText; // ë§ˆí¬ ì´ˆê¸°í™”
        if(td.innerText.includes(name)){
            td.innerHTML = `<mark>${name}</mark>`;
            const card = td.closest('.week-card');
            const sec = td.closest('.month-section');
            if(card) card.querySelector('.week-detail').style.display = 'block';
            if(sec) sec.classList.remove('collapsed');
        }
    });
}

function showMyList(){
    const name = document.getElementById('search-name').value.trim();
    if(!name) { alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"); return; }
    let res = [];
    csvData.forEach(r => {
        const roles = ['ë°˜ì£¼1','ë°˜ì£¼2','ì°¬ì–‘1','ì°¬ì–‘2','ì°¬ìœ¨1','ì°¬ìœ¨2','ì•”ì†¡1','ì•”ì†¡2','ì†ìœ í¬1','ì†ìœ í¬2'];
        roles.forEach(role => {
            if(r[role] && r[role].includes(name)) res.push(`${r.ë‚ ì§œ} [${role.replace(/[0-9]/g,'')}]`);
        });
    });
    alert(res.length > 0 ? `[${name}] ë‹˜ ë‹´ë‹¹:\n` + res.join('\n') : "ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
}

function exportImage(){
    html2canvas(document.getElementById('table-container'),{scale:2}).then(c=>{
        const a=document.createElement('a');
        a.href=c.toDataURL();
        a.download='2025_ê¸°ëŠ¥ì¼ì •.png';
        a.click();
    });
}
</script>
</body>
</html>

