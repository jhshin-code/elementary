<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <title>2026 ê¸°ëŠ¥ ìš”ì•½í‘œ (ê¸°ëŠ¥ í†µí•©í˜•)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f4f4; padding: 20px; }
        #table-container { max-width: 1000px; margin: 0 auto; padding-top: 60px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        td, th { border: 1px solid #ccc; padding: 10px; text-align: center; }
        
        /* ê°•ì¡° íš¨ê³¼ */
        tr.highlight td { background-color: #fff8e1 !important; border: 2px solid #ffc107; }
        .font-enlarge { font-size: 1.2rem !important; font-weight: bold; }
        mark { background: #fffd54; color: black; font-weight: bold; }

        /* ë””ìì¸ ìš”ì†Œ */
        .header { cursor: pointer; background-color: #ffffff !important; }
        .group { border-radius: 12px; overflow: hidden; margin-bottom: 25px; display: block; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { position: fixed; top: 0; left: 0; right: 0; background: white; padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; display: flex; justify-content: center; gap: 10px; align-items: center; }
        .search-box { display: flex; gap: 5px; background: #eee; padding: 5px; border-radius: 8px; }
        
        button { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-green { background: #28a745; color: white; }
        .btn-blue { background: #007bff; color: white; }
        .btn-yellow { background: #ffc107; color: black; }
        button:hover { opacity: 0.8; }
    </style>
</head>
<body>

<div class="controls">
    <button id="expand-toggle-button" onclick="toggleExpandAll()" class="btn-green">ì „ì²´ í¼ì¹˜ê¸°</button>
    <div class="search-box">
        <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" type="text" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; width: 100px;"/>
        <button onclick="highlightName()" class="btn-blue">ê²€ìƒ‰</button>
        <button onclick="showMyFunctions()" class="btn-yellow">ë‚´ ê¸°ëŠ¥ ì „ì²´ë³´ê¸°</button>
    </div>
    <button onclick="captureVisible()" class="btn-blue">ğŸ“¸ ìº¡ì²˜í•˜ê¸°</button>
</div>

<div id="table-container">
    <h1 style="text-align:center;">2026 ê¸°ëŠ¥ ìš”ì•½í‘œ</h1>
    <div id="dynamic-content"></div>
</div>

<script>
let globalData = []; // CSV ë°ì´í„°ë¥¼ ì „ì—­ ì €ì¥
let expanded = false;

// 1. CSV ë°ì´í„° ë¡œë“œ
window.onload = function() {
    Papa.parse("data.csv", {
        download: true,
        header: true,
        complete: function(results) {
            globalData = results.data.filter(row => row.ë‚ ì§œ); // ë¹ˆ ì¤„ ì œê±°
            renderTable(globalData);
            highlightThisWeek();
        }
    });
};

// 2. í‘œ ìƒì„± í•¨ìˆ˜
function renderTable(data) {
    const container = document.getElementById('dynamic-content');
    container.innerHTML = "";

    data.forEach((row) => {
        const tbody = document.createElement('tbody');
        tbody.className = "group";
        
        const praiseHTML = row.ì°¬ì–‘LINK ? `<a href="${row.ì°¬ì–‘LINK}" target="_blank" style="text-decoration:none;">ğŸ”— ${row.ì°¬ì–‘ê³¡ëª…}</a>` : (row.ì°¬ì–‘ê³¡ëª… || '-');

        tbody.innerHTML = `
            <tr class="header" data-date="${row.ë‚ ì§œ}" onclick="toggleRow('${row.ë‚ ì§œ}')">
                <td colspan="6" style="text-align:left; padding:15px 20px; word-break: keep-all; overflow-wrap: break-word;">
                    <span style="color:#007bff; font-weight:bold; font-size:0.9rem;">${row.ë‚ ì§œ} (ì¼)</span><br/>
                    <b style="font-size:1.15rem;">${row.ê³¼}ê³¼: ${row.ì œëª©}</b> 
                    <small style="color:#666; margin-left:8px;">(${row.ë§ì”€ || ''})</small>
                    
                    <div style="margin-top:10px; display: flex; flex-direction: column; gap: 6px; color:#444; font-size:0.95rem; line-height:1.5;">
                        <div style="display: flex; align-items: flex-start; gap: 5px;">
                            <span style="white-space: nowrap;">ğŸµ ì°¬ì–‘:</span>
                            <span>${praiseHTML}</span>
                        </div>
                        <div style="display: flex; align-items: flex-start; gap: 5px;">
                            <span style="white-space: nowrap;">ğŸ“– ì•”ì†¡:</span>
                            <span style="color:#555;">${row.ì•”ì†¡ë§ì”€ || '-'}</span>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="people" data-date="${row.ë‚ ì§œ}" style="display:none">
                <td colspan="6" style="padding:0;">
                    <table style="width:100%; border:none; table-layout: fixed;"> <tr style="background:#f1f1f1; font-size:0.85rem; font-weight:bold;">
                            <td style="width:60px;">êµ¬ë¶„</td><td>ğŸ¹ ë°˜ì£¼</td><td>ğŸ¤ ì°¬ì–‘</td><td>ğŸ’ƒ ì°¬ìœ¨</td><td>ğŸ—£ï¸ ì•”ì†¡</td><td>ğŸ‘ ì†ìœ í¬</td>
                        </tr>
                        <tr>
                            <td style="font-weight:bold; color:#28a745; background:#fafafa;">1ë°˜</td>
                            <td class="role-cell">${row.ë°˜ì£¼1 || ''}</td>
                            <td class="role-cell">${row.ì°¬ì–‘1 || ''}</td>
                            <td class="role-cell">${row.ì°¬ìœ¨1 || ''}</td>
                            <td class="role-cell">${row.ì•”ì†¡1 || ''}</td>
                            <td class="role-cell">${row.ì†ìœ í¬1 || ''}</td>
                        </tr>
                        <tr style="border-top: 1px solid #eee;">
                            <td style="font-weight:bold; color:#007bff; background:#fafafa;">2ë°˜</td>
                            <td class="role-cell">${row.ë°˜ì£¼2 || ''}</td>
                            <td class="role-cell">${row.ì°¬ì–‘2 || ''}</td>
                            <td class="role-cell">${row.ì°¬ìœ¨2 || ''}</td>
                            <td class="role-cell">${row.ì•”ì†¡2 || ''}</td>
                            <td class="role-cell">${row.ì†ìœ í¬2 || ''}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        `;
        container.appendChild(tbody);
    });
}

// 3. ì´ë¦„ ê²€ìƒ‰ ë° ê°•ì¡° (ì „ì²´ í¼ì¹˜ê¸° í¬í•¨)
function highlightName() {
    const name = document.getElementById("search-name").value.trim();
    const cells = document.querySelectorAll(".role-cell");
    const peopleRows = document.querySelectorAll(".people");

    // ì´ˆê¸°í™”
    cells.forEach(td => {
        td.innerHTML = td.innerHTML.replace(/<mark>|<\/mark>/g, '');
        td.style.backgroundColor = "";
    });

    if (!name) return;

    cells.forEach(td => {
        if (td.innerText.includes(name)) {
            const regex = new RegExp(name, "g");
            td.innerHTML = td.innerHTML.replace(regex, `<mark>${name}</mark>`);
            
            const parentRow = td.closest(".people");
            parentRow.style.display = ''; // ì¼ì¹˜í•˜ëŠ” í–‰ í¼ì¹˜ê¸°
            parentRow.previousElementSibling.classList.add('font-enlarge');
        }
    });
}

// 4. ë‚´ ê¸°ëŠ¥ ëª¨ì•„ë³´ê¸° (íŒì—…)
function showMyFunctions() {
    const name = document.getElementById("search-name").value.trim();
    if (!name) { alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }

    let results = [];
    const roles = ["ë°˜ì£¼", "ì°¬ì–‘", "ì°¬ìœ¨", "ì•”ì†¡", "ì†ìœ í¬"];

    globalData.forEach(row => {
        // 1ë°˜ ì²´í¬
        roles.forEach((role, i) => {
            const val1 = row[`${role}${i+1}`] || row[`${role}1`]; // í—¤ë” ëª…ì¹­ ëŒ€ì‘
            if (row['ë°˜ì£¼1']?.includes(name)) { /* ë¡œì§ ìƒëµ - ì•„ë˜ì—ì„œ CSV ê¸°ë°˜ìœ¼ë¡œ ì •ë°€ ì²´í¬ */ }
        });
        
        // ì •ë°€ ì²´í¬ (CSV ì»¬ëŸ¼ëª… ê¸°ë°˜)
        const checkRole = (roleKey, roleName, className) => {
            if (row[roleKey] && row[roleKey].includes(name)) {
                results.push({ date: row.ë‚ ì§œ, subject: row.ì œëª©, role: `${className} ${roleName}` });
            }
        };

        ["ë°˜ì£¼1","ì°¬ì–‘1","ì°¬ìœ¨1","ì•”ì†¡1","ì†ìœ í¬1"].forEach(k => checkRole(k, k.replace('1',''), "1ë°˜"));
        ["ë°˜ì£¼2","ì°¬ì–‘2","ì°¬ìœ¨2","ì•”ì†¡2","ì†ìœ í¬2"].forEach(k => checkRole(k, k.replace('2',''), "2ë°˜"));
    });

    if (results.length === 0) { alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

    let html = `<h3>[${name}]ë‹˜ì˜ ë‹´ë‹¹ ë‚´ì—­</h3><table style='width:100%; border-collapse:collapse;' border='1'>
                <tr style='background:#eee'><th>ë‚ ì§œ</th><th>ê³¼ì œ</th><th>ê¸°ëŠ¥</th></tr>`;
    results.forEach(r => html += `<tr><td>${r.date}</td><td>${r.subject}</td><td>${r.role}</td></tr>`);
    html += "</table>";

    const popup = window.open("", "_blank", "width=600,height=500");
    popup.document.write(`<html><head><style>body{font-family:sans-serif;padding:20px} table{width:100%;text-align:center;border-collapse:collapse;}</style></head><body>${html}</body></html>`);
}

// 5. ì´ë²ˆ ì£¼ ê°•ì¡°
function highlightThisWeek() {
    const today = new Date();
    const day = today.getDay();
    let target = new Date();
    target.setDate(today.getDate() + ((7 - day) % 7)); 
    const targetStr = target.toISOString().split('T')[0];

    const header = document.querySelector(`.header[data-date='${targetStr}']`);
    if (header) {
        header.classList.add('highlight', 'font-enlarge');
        toggleRow(targetStr);
        header.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

// 6. ê¸°íƒ€ ë³´ì¡° ê¸°ëŠ¥ (ìº¡ì²˜, í† ê¸€ ë“±)
function toggleRow(date) {
    const row = document.querySelector(`.people[data-date='${date}']`);
    row.style.display = row.style.display === 'none' ? '' : 'none';
}

function toggleExpandAll() {
    expanded = !expanded;
    document.querySelectorAll('.people').forEach(r => r.style.display = expanded ? '' : 'none');
    document.getElementById('expand-toggle-button').innerText = expanded ? "ì „ì²´ ë‹«ê¸°" : "ì „ì²´ í¼ì¹˜ê¸°";
}

function captureVisible() {
    // í¼ì³ì§„ ëª¨ë“  í•­ëª© ìº¡ì²˜
    const target = document.getElementById('table-container');
    html2canvas(target, { scale: 2, backgroundColor: "#f4f4f4" }).then(canvas => {
        const link = document.createElement('a');
        link.download = '2025_ê¸°ëŠ¥ì¼ì •_ì „ì²´.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>
</body>

</html>


