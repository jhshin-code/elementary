<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #4a90e2;
            --highlight-bg: #fffdf5;
            --highlight-border: #ffc107;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: #f0f2f5;
            padding: 20px;
            margin: 0;
        }

        #table-container {
            max-width: 1000px;
            margin: 90px auto 40px;
        }

        /* ìƒë‹¨ ê³ ì • ì»¨íŠ¸ë¡¤ */
        .controls {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: #fff;
            padding: 12px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,.1);
            z-index: 1000;
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-green { background: #28a745; color: #fff; }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-yellow { background: #ffc107; }

        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 110px;
        }

        /* ì›” ì„¹ì…˜ (ì•„ì½”ë””ì–¸) */
        .month-section {
            background: #fff;
            margin-bottom: 25px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
        }

        .month-label {
            background: var(--primary);
            color: #fff;
            padding: 15px 25px;
            font-size: 1.15rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-label::after { content: 'â–¼'; transition: .3s; }
        .month-section.collapsed .month-label::after { transform: rotate(-90deg); }
        .month-section.collapsed .month-content { display: none; }

        /* ì£¼ì°¨ë³„ ì¹´ë“œ */
        .week-card {
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            margin: 15px;
            background: #fff;
            transition: all 0.3s;
        }

        /* ì´ë²ˆ ì£¼ í•˜ì´ë¼ì´íŠ¸ */
        .week-card.highlight {
            border: 3px solid var(--highlight-border);
            background: var(--highlight-bg);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
        }

        .week-header {
            padding: 18px 20px;
            cursor: pointer;
        }

        .week-title {
            font-size: 1.15rem;
            font-weight: bold;
        }

        .title-verse {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 500;
            margin-left: 4px;
        }

        .info-row {
            display: flex;
            gap: 10px;
            margin-top: 8px;
            font-size: 1rem;
            line-height: 1.5;
        }

        .info-label {
            width: 75px;
            color: #888;
            font-weight: bold;
            flex-shrink: 0;
        }

        .info-content {
            flex-grow: 1;
            font-weight: 500;
            word-break: keep-all;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘: í…Œì´ë¸” ê°€ë¡œ ìŠ¤í¬ë¡¤ ë° ì¤„ë°”ê¿ˆ ë°©ì§€ */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 10px;
            border-radius: 8px;
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
            min-width: 550px; /* í…Œì´ë¸” ìµœì†Œ ë„ˆë¹„ í™•ë³´ */
        }

        .detail-table td {
            border: 1px solid #f0f0f0;
            padding: 14px 8px;
            text-align: center;
            white-space: nowrap; /* ê¸€ì ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        .role-header {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 0.85rem;
            color: #555;
        }

        .role-cell {
            font-size: 1rem;
            font-weight: 700;
            background: #fafafa;
        }

        .ban-1 { background: #e9f7ef; color: #28a745; font-weight: 800; }
        .ban-2 { background: #ebf5ff; color: #007bff; font-weight: 800; }

        mark {
            background: #ff5722;
            color: white;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>

<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">ëª¨ë‘ í¼ì¹˜ê¸°/ì ‘ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„ ì…ë ¥" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥ ë³´ê¸°</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center;">2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</h1>
    <p style="text-align:center;color:#6c757d;">â€» ë‹´ë‹¹ ê¸°ëŠ¥ ë¶ˆê°€ ì‹œ ë¯¸ë¦¬ ë§ì”€í•´ì£¼ì„¸ìš”</p>
    <div id="render-area"></div>
</div>

<script>
let csvData = [];
const CURRENT_YEAR = 2026;

// ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜
function parseDate(str) {
    if (!str) return null;
    let y = CURRENT_YEAR, m, d;
    const p = str.includes('/') ? str.split('/') : str.split('-');
    if (p.length === 3) { 
        y = parseInt(p[0]); m = parseInt(p[1]); d = parseInt(p[2]); 
    } else { 
        m = parseInt(p[0]); d = parseInt(p[1]); 
    }
    return new Date(y, m - 1, d);
}

window.onload = () => {
    // CSV ë°ì´í„° ë¡œë“œ (ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€)
    Papa.parse("data.csv?v=" + new Date().getTime(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            csvData.sort((a, b) => parseDate(a.ë‚ ì§œ) - parseDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrent(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë²ˆ ì£¼ì°¨ ìë™ í¼ì¹˜ê¸° ì‹¤í–‰
        }
    });
};

function renderByMonth(data) {
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseDate(r.ë‚ ì§œ);
        if (!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeksHtml = "";
        groups[key].forEach(r => {
            const weekId = r.ë‚ ì§œ.replace(/\//g, '-');
            weeksHtml += `
            <div class="week-card" id="card-${weekId}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary)">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b class="week-title">
                        ${r.ê³¼}ê³¼: ${r.ì œëª©}
                        <span class="title-verse">(${r.ë§ì”€ || ''})</span>
                    </b>

                    <div class="info-row">
                        <span class="info-label">ğŸµ ì°¬ì–‘</span>
                        <span class="info-content">${r['ì°¬ì–‘ ê³¡ëª…'] || '-'}</span>
                    </div>

                    <div class="info-row">
                        <span class="info-label">ğŸ“– ì•”ì†¡</span>
                        <span class="info-content">${r.ì•”ì†¡ë§ì”€ || '-'}</span>
                    </div>
                </div>

                <div class="week-detail" id="det-${weekId}" style="display:none;padding:0 20px 20px;">
                    <div class="table-responsive">
                        <table class="detail-table">
                            <tr class="role-header">
                                <td>êµ¬ë¶„</td><td>ğŸ“šê³µê³¼</td><td>ğŸ¹ë°˜ì£¼</td><td>ğŸ¤ì°¬ì–‘</td>
                                <td>ğŸ’ƒì°¬ìœ¨</td><td>ğŸ“œì•”ì†¡</td><td>ğŸ™Œì†ìœ í¬</td>
                            </tr>
                            <tr>
                                <td class="ban-1">1ë°˜</td>
                                <td class="role-cell">${r.ê³µê³¼1 || ''}</td>
                                <td class="role-cell">${r.ë°˜ì£¼1 || ''}</td>
                                <td class="role-cell">${r.ì°¬ì–‘1 || ''}</td>
                                <td class="role-cell">${r.ì°¬ìœ¨1 || ''}</td>
                                <td class="role-cell">${r.ì•”ì†¡1 || ''}</td>
                                <td class="role-cell">${r.ì†ìœ í¬1 || ''}</td>
                            </tr>
                            <tr>
                                <td class="ban-2">2ë°˜</td>
                                <td class="role-cell">${r.ê³µê³¼2 || ''}</td>
                                <td class="role-cell">${r.ë°˜ì£¼2 || ''}</td>
                                <td class="role-cell">${r.ì°¬ì–‘2 || ''}</td>
                                <td class="role-cell">${r.ì°¬ìœ¨2 || ''}</td>
                                <td class="role-cell">${r.ì•”ì†¡2 || ''}</td>
                                <td class="role-cell">${r.ì†ìœ í¬2 || ''}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>`;
        });

        sec.innerHTML = `
            <div class="month-label" onclick="toggleMonth('${key}')">${y}ë…„ ${parseInt(m)}ì›”</div>
            <div class="month-content">${weeksHtml}</div>
        `;
        area.appendChild(sec);
    });
}

// ìë™ í¼ì¹˜ê¸° ë¡œì§
function autoExpandCurrent() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // ì˜¤ëŠ˜ ì´í›„ ë‚ ì§œ ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ì£¼ì¼ ì°¾ê¸°
    const currentEntry = csvData.find(r => {
        const d = parseDate(r.ë‚ ì§œ);
        return d && d >= today;
    }) || csvData[0];

    if (currentEntry) {
        const d = parseDate(currentEntry.ë‚ ì§œ);
        const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        const weekId = currentEntry.ë‚ ì§œ.replace(/\//g, '-');

        // ì›” ì„¹ì…˜ í¼ì¹˜ê¸°
        const monthSec = document.getElementById(`sec-${monthKey}`);
        if (monthSec) monthSec.classList.remove('collapsed');

        // ìƒì„¸ ë‚´ìš© í¼ì¹˜ê¸°
        const weekDet = document.getElementById(`det-${weekId}`);
        if (weekDet) weekDet.style.display = 'block';

        // ê°•ì¡° í…Œë‘ë¦¬ ë° ìŠ¤í¬ë¡¤ ì´ë™
        const weekCard = document.getElementById(`card-${weekId}`);
        if (weekCard) {
            weekCard.classList.add('highlight');
            setTimeout(() => {
                weekCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 600);
        }
    }
}

function toggleMonth(m) {
    document.getElementById(`sec-${m}`).classList.toggle('collapsed');
}

function toggleWeek(d) {
    const id = d.replace(/\//g, '-');
    const el = document.getElementById(`det-${id}`);
    if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function toggleAllMonths() {
    const sections = document.querySelectorAll('.month-section');
    const isAnyCollapsed = Array.from(sections).some(s => s.classList.contains('collapsed'));
    sections.forEach(s => {
        if (isAnyCollapsed) s.classList.remove('collapsed');
        else s.classList.add('collapsed');
    });
}

function searchName() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return;
    document.querySelectorAll('.role-cell').forEach(td => {
        const originalText = td.innerText;
        td.innerHTML = originalText;
        if (originalText.includes(name)) {
            td.innerHTML = originalText.replace(new RegExp(name, 'g'), `<mark>${name}</mark>`);
            td.closest('.week-detail').style.display = 'block';
            td.closest('.month-section').classList.remove('collapsed');
        }
    });
}

function showMyList() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
    const list = csvData
        .filter(r => Object.values(r).some(v => v.toString().includes(name)))
        .map(r => `${r.ë‚ ì§œ} (${r.ì œëª©})`);
    alert(list.length ? `[${name}] ë‹´ë‹¹:\n` + list.join('\n') : "ë‹´ë‹¹ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
}

function exportImage() {
    const area = document.getElementById('table-container');
    html2canvas(area, { 
        scale: 2,
        useCORS: true,
        backgroundColor: "#f0f2f5"
    }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = `2026_ì´ˆë“±ë¶€_ê¸°ëŠ¥_${new Date().getTime()}.png`;
        link.click();
    });
}
</script>

</body>
</html>
