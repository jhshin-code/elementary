<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #4a90e2;
            --highlight-bg: #fffdf5;
            --highlight-border: #ffc107;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: #f0f2f5;
            padding: 15px;
            margin: 0;
            letter-spacing: -0.5px; /* ê¸€ì ê°„ê²©ì„ ì¢í˜€ ê³µê°„ í™•ë³´ */
        }

        #table-container {
            max-width: 1000px;
            margin: 90px auto 40px;
        }

        /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ */
        .controls {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: #fff;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,.1);
            z-index: 1000;
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-green { background: #28a745; color: #fff; }
        .btn-blue { background: #007bff; color: #fff; }
        .btn-yellow { background: #ffc107; }

        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 90px;
        }

        /* ì›”ë³„ ì„¹ì…˜ */
        .month-section {
            background: #fff;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
        }

        .month-label {
            background: var(--primary);
            color: #fff;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-label::after { content: 'â–¼'; transition: .3s; }
        .month-section.collapsed .month-label::after { transform: rotate(-90deg); }
        .month-section.collapsed .month-content { display: none; }

        /* ì£¼ì°¨ ì¹´ë“œ */
        .week-card {
            border: 1px solid #e1e4e8;
            border-radius: 10px;
            margin: 10px;
            background: #fff;
        }

        .week-card.highlight {
            border: 3px solid var(--highlight-border);
            background: var(--highlight-bg);
        }

        .week-header { padding: 15px; cursor: pointer; }
        .week-title { font-size: 1.05rem; font-weight: bold; }
        .title-verse { font-size: 0.85rem; color: #6c757d; margin-left: 3px; }

        .info-row {
            display: flex;
            gap: 8px;
            margin-top: 6px;
            font-size: 0.95rem;
        }

        .info-label { width: 60px; color: #888; font-weight: bold; flex-shrink: 0; }
        .info-content { flex-grow: 1; font-weight: 500; }

        /* â˜… í…Œì´ë¸” ìµœì í™” â˜… */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* ë‚´ìš©ì— ë§ê²Œ ë„ˆë¹„ ì¡°ì ˆ */
            margin-top: 10px;
        }

        .detail-table td {
            border: 1px solid #eee;
            padding: 12px 2px;
            text-align: center;
            font-size: 0.9rem;
            white-space: nowrap; /* ì¤„ë°”ê¿ˆ ì ˆëŒ€ ë°©ì§€ */
        }

        .role-header td {
            background: #f8f9fa;
            font-weight: bold;
            font-size: 0.75rem;
            color: #555;
            padding: 10px 1px;
        }

        .role-cell { font-weight: 700; background: #fafafa; }
        
        .ban-1 { background: #e9f7ef; color: #28a745; font-weight: 800; width: 40px; }
        .ban-2 { background: #ebf5ff; color: #007bff; font-weight: 800; width: 40px; }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ (í™”ë©´ í­ 480px ì´í•˜) */
        @media (max-width: 480px) {
            body { padding: 10px; }
            #table-container { margin-top: 100px; }
            .detail-table td { 
                font-size: 0.72rem; /* ê¸€ì í¬ê¸°ë¥¼ ë” ì¤„ì—¬ì„œ ì´ëª¨ì§€ í¬í•¨ í•œ ì¤„ ìœ ì§€ */
                padding: 10px 0px; 
            }
            .role-header td { font-size: 0.65rem; }
            .week-header { padding: 12px; }
            .week-title { font-size: 0.95rem; }
            .info-row { font-size: 0.85rem; }
        }

        mark { background: #ff5722; color: white; border-radius: 3px; padding: 0 2px; }
    </style>
</head>

<body>

<div class="controls">
    <button class="btn-green" onclick="toggleAllMonths()">í¼ì¹˜ê¸°</button>
    <input id="search-name" placeholder="ì´ë¦„" onkeyup="if(event.keyCode==13)searchName()">
    <button class="btn-yellow" onclick="showMyList()">ë‚´ ê¸°ëŠ¥</button>
    <button class="btn-blue" onclick="exportImage()">ğŸ“¸ ìº¡ì²˜</button>
</div>

<div id="table-container">
    <h1 style="text-align:center; font-size:1.4rem; margin-bottom:5px;">2026 ì´ˆë“±ë¶€ ê¸°ëŠ¥</h1>
    <p style="text-align:center; color:#6c757d; font-size:0.85rem; margin-top:0;">â€» ë‹´ë‹¹ ë¶ˆê°€ ì‹œ ë¯¸ë¦¬ ë§ì”€í•´ì£¼ì„¸ìš”</p>
    <div id="render-area"></div>
</div>

<script>
let csvData = [];
const CURRENT_YEAR = 2026;

function parseDate(str) {
    if (!str) return null;
    let y = CURRENT_YEAR, m, d;
    const p = str.includes('/') ? str.split('/') : str.split('-');
    if (p.length === 3) { y = parseInt(p[0]); m = parseInt(p[1]); d = parseInt(p[2]); }
    else { m = parseInt(p[0]); d = parseInt(p[1]); }
    return new Date(y, m - 1, d);
}

window.onload = () => {
    Papa.parse("data.csv?v=" + new Date().getTime(), {
        download: true, header: true, skipEmptyLines: true,
        complete: res => {
            csvData = res.data.filter(r => r.ë‚ ì§œ);
            csvData.sort((a, b) => parseDate(a.ë‚ ì§œ) - parseDate(b.ë‚ ì§œ));
            renderByMonth(csvData);
            autoExpandCurrent();
        }
    });
};

function renderByMonth(data) {
    const area = document.getElementById('render-area');
    area.innerHTML = "";
    const groups = {};

    data.forEach(r => {
        const d = parseDate(r.ë‚ ì§œ);
        if (!d) return;
        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(r);
    });

    Object.keys(groups).sort().forEach(key => {
        const [y, m] = key.split('-');
        const sec = document.createElement('div');
        sec.className = "month-section collapsed";
        sec.id = `sec-${key}`;

        let weeksHtml = "";
        groups[key].forEach(r => {
            const weekId = r.ë‚ ì§œ.replace(/\//g, '-');
            weeksHtml += `
            <div class="week-card" id="card-${weekId}">
                <div class="week-header" onclick="toggleWeek('${r.ë‚ ì§œ}')">
                    <b style="color:var(--primary); font-size:0.85rem;">${r.ë‚ ì§œ} (ì¼)</b><br>
                    <b class="week-title">${r.ê³¼}ê³¼: ${r.ì œëª©} <span class="title-verse">(${r.ë§ì”€ || ''})</span></b>
                    <div class="info-row"><span class="info-label">ğŸµ ì°¬ì–‘</span><span class="info-content">${r['ì°¬ì–‘ ê³¡ëª…'] || '-'}</span></div>
                    <div class="info-row"><span class="info-label">ğŸ“– ì•”ì†¡</span><span class="info-content">${r.ì•”ì†¡ë§ì”€ || '-'}</span></div>
                </div>

                <div class="week-detail" id="det-${weekId}" style="display:none; padding:0 8px 15px;">
                    <table class="detail-table">
                        <tr class="role-header">
                            <td style="width:12%">êµ¬ë¶„</td>
                            <td style="width:14.5%">ğŸ“šê³µê³¼</td>
                            <td style="width:14.5%">ğŸ¹ë°˜ì£¼</td>
                            <td style="width:14.5%">ğŸ¤ì°¬ì–‘</td>
                            <td style="width:14.5%">ğŸ’ƒì°¬ìœ¨</td>
                            <td style="width:14.5%">ğŸ“œì•”ì†¡</td>
                            <td style="width:15%">ğŸ™Œì†ìœ í¬</td>
                        </tr>
                        <tr>
                            <td class="ban-1">1ë°˜</td>
                            <td class="role-cell">${r.ê³µê³¼1 || ''}</td>
                            <td class="role-cell">${r.ë°˜ì£¼1 || ''}</td>
                            <td class="role-cell">${r.ì°¬ì–‘1 || ''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨1 || ''}</td>
                            <td class="role-cell">${r.ì•”ì†¡1 || ''}</td>
                            <td class="role-cell">${r.ì†ìœ í¬1 || ''}</td>
                        </tr>
                        <tr>
                            <td class="ban-2">2ë°˜</td>
                            <td class="role-cell">${r.ê³µê³¼2 || ''}</td>
                            <td class="role-cell">${r.ë°˜ì£¼2 || ''}</td>
                            <td class="role-cell">${r.ì°¬ì–‘2 || ''}</td>
                            <td class="role-cell">${r.ì°¬ìœ¨2 || ''}</td>
                            <td class="role-cell">${r.ì•”ì†¡2 || ''}</td>
                            <td class="role-cell">${r.ì†ìœ í¬2 || ''}</td>
                        </tr>
                    </table>
                </div>
            </div>`;
        });

        sec.innerHTML = `
            <div class="month-label" onclick="toggleMonth('${key}')">${y}ë…„ ${parseInt(m)}ì›”</div>
            <div class="month-content">${weeksHtml}</div>
        `;
        area.appendChild(sec);
    });
}

function autoExpandCurrent() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const currentEntry = csvData.find(r => parseDate(r.ë‚ ì§œ) >= today) || csvData[0];

    if (currentEntry) {
        const d = parseDate(currentEntry.ë‚ ì§œ);
        const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        const weekId = currentEntry.ë‚ ì§œ.replace(/\//g, '-');

        document.getElementById(`sec-${monthKey}`)?.classList.remove('collapsed');
        const det = document.getElementById(`det-${weekId}`);
        if(det) det.style.display = 'block';
        const card = document.getElementById(`card-${weekId}`);
        if(card) {
            card.classList.add('highlight');
            setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'center' }), 600);
        }
    }
}

function toggleMonth(m) { document.getElementById(`sec-${m}`).classList.toggle('collapsed'); }
function toggleWeek(d) {
    const el = document.getElementById(`det-${d.replace(/\//g, '-')}`);
    if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
function toggleAllMonths() {
    const secs = document.querySelectorAll('.month-section');
    const isColl = Array.from(secs).some(s => s.classList.contains('collapsed'));
    secs.forEach(s => isColl ? s.classList.remove('collapsed') : s.classList.add('collapsed'));
}

function searchName() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return;
    document.querySelectorAll('.role-cell').forEach(td => {
        const txt = td.innerText;
        td.innerHTML = txt;
        if (txt.includes(name)) {
            td.innerHTML = txt.replace(new RegExp(name, 'g'), `<mark>${name}</mark>`);
            td.closest('.week-detail').style.display = 'block';
            td.closest('.month-section').classList.remove('collapsed');
        }
    });
}

function showMyList() {
    const name = document.getElementById('search-name').value.trim();
    if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
    const list = csvData.filter(r => Object.values(r).some(v => v.toString().includes(name))).map(r => `${r.ë‚ ì§œ} (${r.ì œëª©})`);
    alert(list.length ? `[${name}] ë‹´ë‹¹:\n` + list.join('\n') : "ë‚´ì—­ ì—†ìŒ");
}

function exportImage() {
    html2canvas(document.getElementById('table-container'), { scale: 2, backgroundColor: "#f0f2f5" }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL();
        link.download = 'ì´ˆë“±ë¶€ê¸°ëŠ¥.png';
        link.click();
    });
}
</script>

</body>
</html>

